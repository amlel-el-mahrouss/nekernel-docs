\doxysection{dev/kernel/\+HALKit/\+AMD64/\+Storage/\+AHCI+\+Generic.cc File Reference}
\hypertarget{_a_h_c_i_09_generic_8cc}{}\label{_a_h_c_i_09_generic_8cc}\index{dev/kernel/HALKit/AMD64/Storage/AHCI+Generic.cc@{dev/kernel/HALKit/AMD64/Storage/AHCI+Generic.cc}}
{\ttfamily \#include $<$Kernel\+Kit/\+Device\+Mgr.\+h$>$}\newline
{\ttfamily \#include $<$Kernel\+Kit/\+Drive\+Mgr.\+h$>$}\newline
{\ttfamily \#include $<$Kernel\+Kit/\+User\+Process\+Scheduler.\+h$>$}\newline
{\ttfamily \#include $<$Kernel\+Kit/\+KPC.\+h$>$}\newline
{\ttfamily \#include $<$Firmware\+Kit/\+EPM.\+h$>$}\newline
{\ttfamily \#include $<$modules/\+ATA/\+ATA.\+h$>$}\newline
{\ttfamily \#include $<$modules/\+AHCI/\+AHCI.\+h$>$}\newline
{\ttfamily \#include $<$Kernel\+Kit/\+PCI/\+Iterator.\+h$>$}\newline
{\ttfamily \#include $<$New\+Kit/\+Utils.\+h$>$}\newline
{\ttfamily \#include $<$Kernel\+Kit/\+Lock\+Delegate.\+h$>$}\newline
{\ttfamily \#include $<$Storage\+Kit/\+AHCI.\+h$>$}\newline
\doxysubsubsection*{Namespaces}
\begin{DoxyCompactItemize}
\item 
namespace \mbox{\hyperlink{namespace_ne_o_s}{Ne\+OS}}
\begin{DoxyCompactList}\small\item\em The {\bfseries{Kernel}} namespace. \end{DoxyCompactList}\item 
namespace \mbox{\hyperlink{namespace_ne_o_s_1_1_detail}{Ne\+OS\+::\+Detail}}
\begin{DoxyCompactList}\small\item\em Implementation details namespace. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_ab957a0a50c3cc0acdf6de83b36dd9548}{k\+HBAErr\+Task\+File}}~(1 $<$$<$ 30)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a7ad305678f278b85161340811a0f6d8e}{k\+HBAPx\+Cmd\+ST}}~(0x0001)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_af2e8b600a067a729e5834fd5ae3c3fb9}{k\+HBAPx\+Cmd\+Fre}}~(0x0010)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a205a658892ef2e02a22c6fa498579630}{k\+HBAPx\+Cmd\+FR}}~(0x4000)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_acaf1b319dafc9751f7bc4ca86f9b1c7c}{k\+HBAPx\+Cmd\+CR}}~(0x8000)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a960cb5cd5e9f3d0b57ed89786a4b8436}{k\+SATALBAMode}}~(1 $<$$<$ 6)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a5f42ea770a86dc9f4f2e682045f05ff3}{k\+SATASRBsy}}~(0x80)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_aef538a6e62c40d1abe62d1e269b8862c}{k\+SATASRDrq}}~(0x08)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a788a4e8966769b8b17bd895ce8b5a7ab}{k\+HBABohc\+Bios\+Owned}}~(1 $<$$<$ 0)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a01917d9a0ab9b478bf316df78f64f217}{k\+HBABohc\+OSOwned}}~(1 $<$$<$ 1)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_ae131713444455c9e608464951c29f543}{k\+SATAPort\+Cnt}}~(0x20)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a3783986c37a83c41f59055f956ce94ea}{k\+SATASig}}~(0x00000101)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_ab4394fc2192a33bbca4e9a8b5e945c1e}{k\+SATAPISig}}~(0x\+EB140101)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a9cd531a784e0b4a70f49507766b28a08}{k\+SATAProg\+If\+AHCI}}~(0x01)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_ae1a1ea6fd8b63304837659d10c370d05}{k\+SATASub\+Class}}~(0x06)
\item 
\#define \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_aea288e59f506d46d77a6f10cb66c4ba7}{k\+SATABar5}}~(0x24)
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
{\footnotesize template$<$\mbox{\hyperlink{ddk_8h_ae4cc35dcc70810fa972cc8a5185a28fa}{BOOL}} Write, \mbox{\hyperlink{ddk_8h_ae4cc35dcc70810fa972cc8a5185a28fa}{BOOL}} Command\+Or\+CTRL, \mbox{\hyperlink{ddk_8h_ae4cc35dcc70810fa972cc8a5185a28fa}{BOOL}} Identify$>$ }\\\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad33956dfc567efebd063d7bc6d1ae82d}{Void}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_ab8b8dc8469414e865471bdbfeaad4206}{drv\+\_\+std\+\_\+input\+\_\+output\+\_\+ahci}} (\mbox{\hyperlink{namespace_ne_o_s_a09d79cd68f15b02280f00125b4e62cb5}{UInt64}} lba, \mbox{\hyperlink{namespace_ne_o_s_a0835cc5d92716e99fd7387e297984399}{UInt8}} \texorpdfstring{$\ast$}{*}buffer, \mbox{\hyperlink{namespace_ne_o_s_a5bbd9eec89d9fb8e95178b14ce2fcafc}{SizeT}} sector\+\_\+sz, \mbox{\hyperlink{namespace_ne_o_s_a5bbd9eec89d9fb8e95178b14ce2fcafc}{SizeT}} size\+\_\+buffer) noexcept
\begin{DoxyCompactList}\small\item\em Send an AHCI command, according to the template parameters. \end{DoxyCompactList}\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_a91a19724952b6c6faf9b52f9efc935f7}{Int32}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a81793346f8465f747d5174aa7c5f3305}{drv\+\_\+find\+\_\+cmd\+\_\+slot\+\_\+ahci}} (\mbox{\hyperlink{struct_hba_port}{Hba\+Port}} \texorpdfstring{$\ast$}{*}port) noexcept
\begin{DoxyCompactList}\small\item\em Finds a command slot for a HBA port. \end{DoxyCompactList}\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad33956dfc567efebd063d7bc6d1ae82d}{Void}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a67852af44304f7a502bc211ad0701db2}{drv\+\_\+compute\+\_\+disk\+\_\+ahci}} () noexcept
\item 
\mbox{\hyperlink{namespace_ne_o_s_a5bbd9eec89d9fb8e95178b14ce2fcafc}{SizeT}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a136757d634973d03e56b19e603cc88a0}{drv\+\_\+get\+\_\+sector\+\_\+count\+\_\+ahci}} ()
\item 
\mbox{\hyperlink{namespace_ne_o_s_a5bbd9eec89d9fb8e95178b14ce2fcafc}{SizeT}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a79095a2620dbea433239656bec8aab3d}{drv\+\_\+get\+\_\+size\+\_\+ahci}} ()
\begin{DoxyCompactList}\small\item\em Get the drive size. \end{DoxyCompactList}\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad33956dfc567efebd063d7bc6d1ae82d}{Void}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_af0f08823be182f25916b563225597598}{ahci\+\_\+enable\+\_\+and\+\_\+probe}} ()
\begin{DoxyCompactList}\small\item\em Enable Host and probe using the IDENTIFY command. \end{DoxyCompactList}\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad5f3c5e87966b36f6741ac5897f80120}{Bool}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_abf101e92a70ac5e67b6e7823ffc9152a}{drv\+\_\+std\+\_\+init\+\_\+ahci}} (\mbox{\hyperlink{namespace_ne_o_s_a4885ae005fc56130691bdea86d9a88d7}{UInt16}} \&pi, \mbox{\hyperlink{ddk_8h_ae4cc35dcc70810fa972cc8a5185a28fa}{BOOL}} \&atapi)
\begin{DoxyCompactList}\small\item\em Initializes an AHCI disk. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespace_ne_o_s_ad5f3c5e87966b36f6741ac5897f80120}{Bool}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a581628e54347deeee3e90542cb2e5c35}{drv\+\_\+std\+\_\+detected\+\_\+ahci}} ()
\begin{DoxyCompactList}\small\item\em Checks if an AHCI device is detected. \end{DoxyCompactList}\item 
\mbox{\hyperlink{namespace_ne_o_s_a4885ae005fc56130691bdea86d9a88d7}{UInt16}} \mbox{\hyperlink{namespace_ne_o_s_a83eb52538c700658beb073f39ea5265b}{Ne\+OS\+::sk\+\_\+init\+\_\+ahci\+\_\+device}} (\mbox{\hyperlink{ddk_8h_ae4cc35dcc70810fa972cc8a5185a28fa}{BOOL}} atapi)
\begin{DoxyCompactList}\small\item\em Initialize an AHCI device (Storage\+Kit) \end{DoxyCompactList}\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad33956dfc567efebd063d7bc6d1ae82d}{Void}} \mbox{\hyperlink{namespace_ne_o_s_1_1_detail_a275cc52f09d7ad5c155d5af9ac04b3aa}{Ne\+OS\+::\+Detail\+::sk\+\_\+io\+\_\+read\+\_\+ahci}} (\mbox{\hyperlink{class_ne_o_s_1_1_i_device_object}{IDevice\+Object}}$<$ \mbox{\hyperlink{class_ne_o_s_1_1_mountpoint_interface}{Mountpoint\+Interface}} \texorpdfstring{$\ast$}{*} $>$ \texorpdfstring{$\ast$}{*}self, \mbox{\hyperlink{class_ne_o_s_1_1_mountpoint_interface}{Mountpoint\+Interface}} \texorpdfstring{$\ast$}{*}mnt)
\begin{DoxyCompactList}\small\item\em Read AHCI device. \end{DoxyCompactList}\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad33956dfc567efebd063d7bc6d1ae82d}{Void}} \mbox{\hyperlink{namespace_ne_o_s_1_1_detail_a435076d327d4c44790f9d05cbf5f8d61}{Ne\+OS\+::\+Detail\+::sk\+\_\+io\+\_\+write\+\_\+ahci}} (\mbox{\hyperlink{class_ne_o_s_1_1_i_device_object}{IDevice\+Object}}$<$ \mbox{\hyperlink{class_ne_o_s_1_1_mountpoint_interface}{Mountpoint\+Interface}} \texorpdfstring{$\ast$}{*} $>$ \texorpdfstring{$\ast$}{*}self, \mbox{\hyperlink{class_ne_o_s_1_1_mountpoint_interface}{Mountpoint\+Interface}} \texorpdfstring{$\ast$}{*}mnt)
\begin{DoxyCompactList}\small\item\em Write AHCI device. \end{DoxyCompactList}\item 
\mbox{\hyperlink{class_ne_o_s_1_1_error_or}{Error\+Or}}$<$ AHCIDevice\+Interface $>$ \mbox{\hyperlink{namespace_ne_o_s_ad84cc1ceddd8f4e0d7691f14466bdc78}{Ne\+OS\+::sk\+\_\+acquire\+\_\+ahci\+\_\+device}} (\mbox{\hyperlink{namespace_ne_o_s_a91a19724952b6c6faf9b52f9efc935f7}{Int32}} drv\+\_\+index)
\begin{DoxyCompactList}\small\item\em Acquires a new AHCI device with drv\+\_\+index in mind. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{class_ne_o_s_1_1_p_c_i_1_1_device}{PCI\+::\+Device}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_afd5804aa0056abe7581eacf5b2c7aedf}{k\+SATADev}}
\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{modules_2_a_h_c_i_2_a_h_c_i_8h_a43b142b9efb9165ea0ac216f5ef89a73}{Hba\+Mem\+Ref}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a61f41f9f33998e2cecd6d824de6d6f98}{k\+SATAHba}}
\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_a6c7d716f879df82186c7178f1271e502}{Lba}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a874e4a5ae6c5e6c37c9515d4bddf4110}{k\+SATASector\+Count}} = 0\+UL
\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_a4885ae005fc56130691bdea86d9a88d7}{UInt16}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a5450b73830ec02982aa12ab3928aef3e}{k\+SATAIndex}} = 0U
\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_af96b578c23518d339d562bbab4efa72f}{Char}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a92964c52ff13bc8cf67c2d61c1feee74}{k\+Current\+Disk\+Model}} \mbox{[}50\mbox{]} = \{"{}UNKNOWN AHCI DRIVE"{}\}
\item 
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_a4885ae005fc56130691bdea86d9a88d7}{UInt16}} \mbox{\hyperlink{_a_h_c_i_09_generic_8cc_a1c5b524098fc0bfdaf1a1dee5f0c93f2}{k\+SATAPorts\+Implemented}} = 0U
\end{DoxyCompactItemize}


\doxysubsection{Macro Definition Documentation}
\Hypertarget{_a_h_c_i_09_generic_8cc_a788a4e8966769b8b17bd895ce8b5a7ab}\label{_a_h_c_i_09_generic_8cc_a788a4e8966769b8b17bd895ce8b5a7ab} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kHBABohcBiosOwned@{kHBABohcBiosOwned}}
\index{kHBABohcBiosOwned@{kHBABohcBiosOwned}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kHBABohcBiosOwned}{kHBABohcBiosOwned}}
{\footnotesize\ttfamily \#define k\+HBABohc\+Bios\+Owned~(1 $<$$<$ 0)}

\Hypertarget{_a_h_c_i_09_generic_8cc_a01917d9a0ab9b478bf316df78f64f217}\label{_a_h_c_i_09_generic_8cc_a01917d9a0ab9b478bf316df78f64f217} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kHBABohcOSOwned@{kHBABohcOSOwned}}
\index{kHBABohcOSOwned@{kHBABohcOSOwned}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kHBABohcOSOwned}{kHBABohcOSOwned}}
{\footnotesize\ttfamily \#define k\+HBABohc\+OSOwned~(1 $<$$<$ 1)}

\Hypertarget{_a_h_c_i_09_generic_8cc_ab957a0a50c3cc0acdf6de83b36dd9548}\label{_a_h_c_i_09_generic_8cc_ab957a0a50c3cc0acdf6de83b36dd9548} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kHBAErrTaskFile@{kHBAErrTaskFile}}
\index{kHBAErrTaskFile@{kHBAErrTaskFile}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kHBAErrTaskFile}{kHBAErrTaskFile}}
{\footnotesize\ttfamily \#define k\+HBAErr\+Task\+File~(1 $<$$<$ 30)}

\Hypertarget{_a_h_c_i_09_generic_8cc_acaf1b319dafc9751f7bc4ca86f9b1c7c}\label{_a_h_c_i_09_generic_8cc_acaf1b319dafc9751f7bc4ca86f9b1c7c} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kHBAPxCmdCR@{kHBAPxCmdCR}}
\index{kHBAPxCmdCR@{kHBAPxCmdCR}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kHBAPxCmdCR}{kHBAPxCmdCR}}
{\footnotesize\ttfamily \#define k\+HBAPx\+Cmd\+CR~(0x8000)}

\Hypertarget{_a_h_c_i_09_generic_8cc_a205a658892ef2e02a22c6fa498579630}\label{_a_h_c_i_09_generic_8cc_a205a658892ef2e02a22c6fa498579630} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kHBAPxCmdFR@{kHBAPxCmdFR}}
\index{kHBAPxCmdFR@{kHBAPxCmdFR}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kHBAPxCmdFR}{kHBAPxCmdFR}}
{\footnotesize\ttfamily \#define k\+HBAPx\+Cmd\+FR~(0x4000)}

\Hypertarget{_a_h_c_i_09_generic_8cc_af2e8b600a067a729e5834fd5ae3c3fb9}\label{_a_h_c_i_09_generic_8cc_af2e8b600a067a729e5834fd5ae3c3fb9} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kHBAPxCmdFre@{kHBAPxCmdFre}}
\index{kHBAPxCmdFre@{kHBAPxCmdFre}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kHBAPxCmdFre}{kHBAPxCmdFre}}
{\footnotesize\ttfamily \#define k\+HBAPx\+Cmd\+Fre~(0x0010)}

\Hypertarget{_a_h_c_i_09_generic_8cc_a7ad305678f278b85161340811a0f6d8e}\label{_a_h_c_i_09_generic_8cc_a7ad305678f278b85161340811a0f6d8e} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kHBAPxCmdST@{kHBAPxCmdST}}
\index{kHBAPxCmdST@{kHBAPxCmdST}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kHBAPxCmdST}{kHBAPxCmdST}}
{\footnotesize\ttfamily \#define k\+HBAPx\+Cmd\+ST~(0x0001)}

\Hypertarget{_a_h_c_i_09_generic_8cc_aea288e59f506d46d77a6f10cb66c4ba7}\label{_a_h_c_i_09_generic_8cc_aea288e59f506d46d77a6f10cb66c4ba7} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATABar5@{kSATABar5}}
\index{kSATABar5@{kSATABar5}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATABar5}{kSATABar5}}
{\footnotesize\ttfamily \#define k\+SATABar5~(0x24)}

\Hypertarget{_a_h_c_i_09_generic_8cc_a960cb5cd5e9f3d0b57ed89786a4b8436}\label{_a_h_c_i_09_generic_8cc_a960cb5cd5e9f3d0b57ed89786a4b8436} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATALBAMode@{kSATALBAMode}}
\index{kSATALBAMode@{kSATALBAMode}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATALBAMode}{kSATALBAMode}}
{\footnotesize\ttfamily \#define k\+SATALBAMode~(1 $<$$<$ 6)}

\Hypertarget{_a_h_c_i_09_generic_8cc_ab4394fc2192a33bbca4e9a8b5e945c1e}\label{_a_h_c_i_09_generic_8cc_ab4394fc2192a33bbca4e9a8b5e945c1e} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATAPISig@{kSATAPISig}}
\index{kSATAPISig@{kSATAPISig}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATAPISig}{kSATAPISig}}
{\footnotesize\ttfamily \#define k\+SATAPISig~(0x\+EB140101)}

\Hypertarget{_a_h_c_i_09_generic_8cc_ae131713444455c9e608464951c29f543}\label{_a_h_c_i_09_generic_8cc_ae131713444455c9e608464951c29f543} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATAPortCnt@{kSATAPortCnt}}
\index{kSATAPortCnt@{kSATAPortCnt}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATAPortCnt}{kSATAPortCnt}}
{\footnotesize\ttfamily \#define k\+SATAPort\+Cnt~(0x20)}

\Hypertarget{_a_h_c_i_09_generic_8cc_a9cd531a784e0b4a70f49507766b28a08}\label{_a_h_c_i_09_generic_8cc_a9cd531a784e0b4a70f49507766b28a08} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATAProgIfAHCI@{kSATAProgIfAHCI}}
\index{kSATAProgIfAHCI@{kSATAProgIfAHCI}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATAProgIfAHCI}{kSATAProgIfAHCI}}
{\footnotesize\ttfamily \#define k\+SATAProg\+If\+AHCI~(0x01)}

\Hypertarget{_a_h_c_i_09_generic_8cc_a3783986c37a83c41f59055f956ce94ea}\label{_a_h_c_i_09_generic_8cc_a3783986c37a83c41f59055f956ce94ea} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATASig@{kSATASig}}
\index{kSATASig@{kSATASig}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATASig}{kSATASig}}
{\footnotesize\ttfamily \#define k\+SATASig~(0x00000101)}

\Hypertarget{_a_h_c_i_09_generic_8cc_a5f42ea770a86dc9f4f2e682045f05ff3}\label{_a_h_c_i_09_generic_8cc_a5f42ea770a86dc9f4f2e682045f05ff3} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATASRBsy@{kSATASRBsy}}
\index{kSATASRBsy@{kSATASRBsy}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATASRBsy}{kSATASRBsy}}
{\footnotesize\ttfamily \#define k\+SATASRBsy~(0x80)}

\Hypertarget{_a_h_c_i_09_generic_8cc_aef538a6e62c40d1abe62d1e269b8862c}\label{_a_h_c_i_09_generic_8cc_aef538a6e62c40d1abe62d1e269b8862c} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATASRDrq@{kSATASRDrq}}
\index{kSATASRDrq@{kSATASRDrq}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATASRDrq}{kSATASRDrq}}
{\footnotesize\ttfamily \#define k\+SATASRDrq~(0x08)}

\Hypertarget{_a_h_c_i_09_generic_8cc_ae1a1ea6fd8b63304837659d10c370d05}\label{_a_h_c_i_09_generic_8cc_ae1a1ea6fd8b63304837659d10c370d05} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATASubClass@{kSATASubClass}}
\index{kSATASubClass@{kSATASubClass}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATASubClass}{kSATASubClass}}
{\footnotesize\ttfamily \#define k\+SATASub\+Class~(0x06)}



\doxysubsection{Function Documentation}
\Hypertarget{_a_h_c_i_09_generic_8cc_af0f08823be182f25916b563225597598}\label{_a_h_c_i_09_generic_8cc_af0f08823be182f25916b563225597598} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!ahci\_enable\_and\_probe@{ahci\_enable\_and\_probe}}
\index{ahci\_enable\_and\_probe@{ahci\_enable\_and\_probe}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{ahci\_enable\_and\_probe()}{ahci\_enable\_and\_probe()}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad33956dfc567efebd063d7bc6d1ae82d}{Void}} ahci\+\_\+enable\+\_\+and\+\_\+probe (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Enable Host and probe using the IDENTIFY command. 

\Hypertarget{_a_h_c_i_09_generic_8cc_a67852af44304f7a502bc211ad0701db2}\label{_a_h_c_i_09_generic_8cc_a67852af44304f7a502bc211ad0701db2} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!drv\_compute\_disk\_ahci@{drv\_compute\_disk\_ahci}}
\index{drv\_compute\_disk\_ahci@{drv\_compute\_disk\_ahci}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{drv\_compute\_disk\_ahci()}{drv\_compute\_disk\_ahci()}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad33956dfc567efebd063d7bc6d1ae82d}{Void}} drv\+\_\+compute\+\_\+disk\+\_\+ahci (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}

Normally 512 bytes, but add an additional 512 bytes to make 1 KIB.

Push it to the stack

Send AHCI command.

Extract 28-\/bit LBA.

Show what we got.\Hypertarget{_a_h_c_i_09_generic_8cc_a81793346f8465f747d5174aa7c5f3305}\label{_a_h_c_i_09_generic_8cc_a81793346f8465f747d5174aa7c5f3305} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!drv\_find\_cmd\_slot\_ahci@{drv\_find\_cmd\_slot\_ahci}}
\index{drv\_find\_cmd\_slot\_ahci@{drv\_find\_cmd\_slot\_ahci}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{drv\_find\_cmd\_slot\_ahci()}{drv\_find\_cmd\_slot\_ahci()}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_a91a19724952b6c6faf9b52f9efc935f7}{Int32}} drv\+\_\+find\+\_\+cmd\+\_\+slot\+\_\+ahci (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_hba_port}{Hba\+Port}} \texorpdfstring{$\ast$}{*}}]{port }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Finds a command slot for a HBA port. 


\begin{DoxyParams}{Parameters}
{\em port} & The port to search on. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The slot, or \texorpdfstring{$\sim$}{\string~}0. 
\end{DoxyReturn}
\Hypertarget{_a_h_c_i_09_generic_8cc_a136757d634973d03e56b19e603cc88a0}\label{_a_h_c_i_09_generic_8cc_a136757d634973d03e56b19e603cc88a0} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!drv\_get\_sector\_count\_ahci@{drv\_get\_sector\_count\_ahci}}
\index{drv\_get\_sector\_count\_ahci@{drv\_get\_sector\_count\_ahci}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{drv\_get\_sector\_count\_ahci()}{drv\_get\_sector\_count\_ahci()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespace_ne_o_s_a5bbd9eec89d9fb8e95178b14ce2fcafc}{SizeT}} drv\+\_\+get\+\_\+sector\+\_\+count\+\_\+ahci (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\Hypertarget{_a_h_c_i_09_generic_8cc_a79095a2620dbea433239656bec8aab3d}\label{_a_h_c_i_09_generic_8cc_a79095a2620dbea433239656bec8aab3d} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!drv\_get\_size\_ahci@{drv\_get\_size\_ahci}}
\index{drv\_get\_size\_ahci@{drv\_get\_size\_ahci}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{drv\_get\_size\_ahci()}{drv\_get\_size\_ahci()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespace_ne_o_s_a5bbd9eec89d9fb8e95178b14ce2fcafc}{SizeT}} drv\+\_\+get\+\_\+size\+\_\+ahci (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Get the drive size. 

\begin{DoxyReturn}{Returns}
Disk size in bytes. 
\end{DoxyReturn}
\Hypertarget{_a_h_c_i_09_generic_8cc_a581628e54347deeee3e90542cb2e5c35}\label{_a_h_c_i_09_generic_8cc_a581628e54347deeee3e90542cb2e5c35} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!drv\_std\_detected\_ahci@{drv\_std\_detected\_ahci}}
\index{drv\_std\_detected\_ahci@{drv\_std\_detected\_ahci}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{drv\_std\_detected\_ahci()}{drv\_std\_detected\_ahci()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespace_ne_o_s_ad5f3c5e87966b36f6741ac5897f80120}{Bool}} drv\+\_\+std\+\_\+detected\+\_\+ahci (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Checks if an AHCI device is detected. 

\begin{DoxyReturn}{Returns}
Either if detected, or not found. 
\end{DoxyReturn}
\Hypertarget{_a_h_c_i_09_generic_8cc_abf101e92a70ac5e67b6e7823ffc9152a}\label{_a_h_c_i_09_generic_8cc_abf101e92a70ac5e67b6e7823ffc9152a} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!drv\_std\_init\_ahci@{drv\_std\_init\_ahci}}
\index{drv\_std\_init\_ahci@{drv\_std\_init\_ahci}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{drv\_std\_init\_ahci()}{drv\_std\_init\_ahci()}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad5f3c5e87966b36f6741ac5897f80120}{Bool}} drv\+\_\+std\+\_\+init\+\_\+ahci (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespace_ne_o_s_a4885ae005fc56130691bdea86d9a88d7}{UInt16}} \&}]{pi,  }\item[{\mbox{\hyperlink{ddk_8h_ae4cc35dcc70810fa972cc8a5185a28fa}{BOOL}} \&}]{atapi }\end{DoxyParamCaption})}



Initializes an AHCI disk. 


\begin{DoxyParams}{Parameters}
{\em pi} & the amount of ports that have been detected. \\
\hline
{\em atapi} & reference value, tells whether we should detect ATAPI instead of SATA. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
if the disk was successfully initialized or not. 
\end{DoxyReturn}
\Hypertarget{_a_h_c_i_09_generic_8cc_ab8b8dc8469414e865471bdbfeaad4206}\label{_a_h_c_i_09_generic_8cc_ab8b8dc8469414e865471bdbfeaad4206} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!drv\_std\_input\_output\_ahci@{drv\_std\_input\_output\_ahci}}
\index{drv\_std\_input\_output\_ahci@{drv\_std\_input\_output\_ahci}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{drv\_std\_input\_output\_ahci()}{drv\_std\_input\_output\_ahci()}}
{\footnotesize\ttfamily template$<$\mbox{\hyperlink{ddk_8h_ae4cc35dcc70810fa972cc8a5185a28fa}{BOOL}} Write, \mbox{\hyperlink{ddk_8h_ae4cc35dcc70810fa972cc8a5185a28fa}{BOOL}} Command\+Or\+CTRL, \mbox{\hyperlink{ddk_8h_ae4cc35dcc70810fa972cc8a5185a28fa}{BOOL}} Identify$>$ \\
\mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_ad33956dfc567efebd063d7bc6d1ae82d}{Void}} drv\+\_\+std\+\_\+input\+\_\+output\+\_\+ahci (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespace_ne_o_s_a09d79cd68f15b02280f00125b4e62cb5}{UInt64}}}]{lba,  }\item[{\mbox{\hyperlink{namespace_ne_o_s_a0835cc5d92716e99fd7387e297984399}{UInt8}} \texorpdfstring{$\ast$}{*}}]{buffer,  }\item[{\mbox{\hyperlink{namespace_ne_o_s_a5bbd9eec89d9fb8e95178b14ce2fcafc}{SizeT}}}]{sector\+\_\+sz,  }\item[{\mbox{\hyperlink{namespace_ne_o_s_a5bbd9eec89d9fb8e95178b14ce2fcafc}{SizeT}}}]{size\+\_\+buffer }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [noexcept]}}



Send an AHCI command, according to the template parameters. 


\begin{DoxyParams}{Parameters}
{\em lba} & Logical Block Address to look for. \\
\hline
{\em buffer} & The data buffer to transfer. \\
\hline
{\em sector\+\_\+sz} & The disk\textquotesingle{}s sector size (unused) \\
\hline
{\em size\+\_\+buffer} & The size of the {\bfseries{buffer}} parameter. \\
\hline
\end{DoxyParams}


\doxysubsection{Variable Documentation}
\Hypertarget{_a_h_c_i_09_generic_8cc_a92964c52ff13bc8cf67c2d61c1feee74}\label{_a_h_c_i_09_generic_8cc_a92964c52ff13bc8cf67c2d61c1feee74} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kCurrentDiskModel@{kCurrentDiskModel}}
\index{kCurrentDiskModel@{kCurrentDiskModel}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kCurrentDiskModel}{kCurrentDiskModel}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_af96b578c23518d339d562bbab4efa72f}{Char}} k\+Current\+Disk\+Model\mbox{[}50\mbox{]} = \{"{}UNKNOWN AHCI DRIVE"{}\}}

\Hypertarget{_a_h_c_i_09_generic_8cc_afd5804aa0056abe7581eacf5b2c7aedf}\label{_a_h_c_i_09_generic_8cc_afd5804aa0056abe7581eacf5b2c7aedf} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATADev@{kSATADev}}
\index{kSATADev@{kSATADev}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATADev}{kSATADev}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{class_ne_o_s_1_1_p_c_i_1_1_device}{PCI\+::\+Device}} k\+SATADev}

\Hypertarget{_a_h_c_i_09_generic_8cc_a61f41f9f33998e2cecd6d824de6d6f98}\label{_a_h_c_i_09_generic_8cc_a61f41f9f33998e2cecd6d824de6d6f98} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATAHba@{kSATAHba}}
\index{kSATAHba@{kSATAHba}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATAHba}{kSATAHba}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{modules_2_a_h_c_i_2_a_h_c_i_8h_a43b142b9efb9165ea0ac216f5ef89a73}{Hba\+Mem\+Ref}} k\+SATAHba}

\Hypertarget{_a_h_c_i_09_generic_8cc_a5450b73830ec02982aa12ab3928aef3e}\label{_a_h_c_i_09_generic_8cc_a5450b73830ec02982aa12ab3928aef3e} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATAIndex@{kSATAIndex}}
\index{kSATAIndex@{kSATAIndex}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATAIndex}{kSATAIndex}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_a4885ae005fc56130691bdea86d9a88d7}{UInt16}} k\+SATAIndex = 0U}

\Hypertarget{_a_h_c_i_09_generic_8cc_a1c5b524098fc0bfdaf1a1dee5f0c93f2}\label{_a_h_c_i_09_generic_8cc_a1c5b524098fc0bfdaf1a1dee5f0c93f2} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATAPortsImplemented@{kSATAPortsImplemented}}
\index{kSATAPortsImplemented@{kSATAPortsImplemented}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATAPortsImplemented}{kSATAPortsImplemented}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_a4885ae005fc56130691bdea86d9a88d7}{UInt16}} k\+SATAPorts\+Implemented = 0U}

\Hypertarget{_a_h_c_i_09_generic_8cc_a874e4a5ae6c5e6c37c9515d4bddf4110}\label{_a_h_c_i_09_generic_8cc_a874e4a5ae6c5e6c37c9515d4bddf4110} 
\index{AHCI+Generic.cc@{AHCI+Generic.cc}!kSATASectorCount@{kSATASectorCount}}
\index{kSATASectorCount@{kSATASectorCount}!AHCI+Generic.cc@{AHCI+Generic.cc}}
\doxysubsubsection{\texorpdfstring{kSATASectorCount}{kSATASectorCount}}
{\footnotesize\ttfamily \mbox{\hyperlink{kernel_2_new_kit_2_macros_8h_a10b2d890d871e1489bb02b7e70d9bdfb}{STATIC}} \mbox{\hyperlink{namespace_ne_o_s_a6c7d716f879df82186c7178f1271e502}{Lba}} k\+SATASector\+Count = 0\+UL}

